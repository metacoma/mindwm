{% set p = inventory.parameters %}

input {
  tcp {
    port => {{ p.logstash.input.tmux.port }}
    codec => fluent
  }
}

output {

  # https://upstash.com/blog/logstash-kafka-upstash
  {% if "kafka_tmux_topic" in p %}
  kafka {
     codec => json
     topic_id => "{{ p.kafka_tmux_topic }}"
     bootstrap_servers => "{{ p.kafka.host }}:{{ p.kafka.port }}"
  } 
  {% endif %}
  opensearch {
    hosts => ["127.0.0.1:9200"]
    index  => "tmux-%{+YYYY.MM.dd}"
    user => "admin"
    password => "admin"
    ssl => true
    ssl_certificate_verification => false
  }
  stdout {
  }
}
